{"remainingRequest":"D:\\workspace\\bot-manager\\bot-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\workspace\\bot-manager\\bot-ui\\src\\utils\\htmlToPdf.js","dependencies":[{"path":"D:\\workspace\\bot-manager\\bot-ui\\src\\utils\\htmlToPdf.js","mtime":1702475008418},{"path":"D:\\workspace\\bot-manager\\bot-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace\\bot-manager\\bot-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJEOi93b3Jrc3BhY2UvYm90LW1hbmFnZXIvYm90LXVpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IGh0bWwyY2FudmFzIGZyb20gImh0bWwyY2FudmFzIjsKaW1wb3J0IGpzUGRmIGZyb20gImpzcGRmIjsKCmZ1bmN0aW9uIGh0bWxUb1BkZihfeCkgewogIHJldHVybiBfaHRtbFRvUGRmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KLyoqDQogKiAgQHBhcmFtIGVsSWQg5omT5Y2w55qE6IqC54K5SUQNCiAqLwoKCmZ1bmN0aW9uIF9odG1sVG9QZGYoKSB7CiAgX2h0bWxUb1BkZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh0aXRsZSkgewogICAgdmFyIGVsSWQsIGh0bWxDYW52YXMsIHBkZjsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZWxJZCA9ICdwZGZDb250ZW50JzsgLy8gYm9keTog5oOz6KaB55Sf5oiQIHBkZiDnmoTpobXpnaLnmoRpZAoKICAgICAgICAgICAgaWYgKGVsSWQpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGUKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5a+85Ye66IqC54K55LiN5a2Y5Zyo77yBJyk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgIHJldHVybiBnZXRDYW52YXNCeUh0bWxJZChlbElkKTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGh0bWxDYW52YXMgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAvLyDlsIZjYW52YXPlr7nosaHovazkuLpwZGYKICAgICAgICAgICAgcGRmID0gY2FudmFzVG9QZGYoaHRtbENhbnZhcyk7IC8vIOmAmui/h+a1j+iniOWZqOS4i+i9vXBkZgoKICAgICAgICAgICAgZG93blBkZihwZGYsIHRpdGxlKTsKCiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSk7CiAgfSkpOwogIHJldHVybiBfaHRtbFRvUGRmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIGdldENhbnZhc0J5SHRtbElkKF94MikgewogIHJldHVybiBfZ2V0Q2FudmFzQnlIdG1sSWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQovKioNCiAqICBAcGFyYW0gaHRtbENhbnZhcyBjYW52YXPlr7nosaENCiAqLwoKCmZ1bmN0aW9uIF9nZXRDYW52YXNCeUh0bWxJZCgpIHsKICBfZ2V0Q2FudmFzQnlIdG1sSWQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGVsSWQpIHsKICAgIHZhciBlbElkRG9tLCBjYW52YXM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBlbElkRG9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxJZCk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIGh0bWwyY2FudmFzKGVsSWREb20sIHsKICAgICAgICAgICAgICBzY2FsZTogMiwKICAgICAgICAgICAgICB1c2VDT1JTOiB0cnVlLAogICAgICAgICAgICAgIGFsbG93VGFpbnQ6IHRydWUsCiAgICAgICAgICAgICAgLy8gdGFpbnRUZXN0OiBmYWxzZSwKICAgICAgICAgICAgICBpbWFnZVRpbWVvdXQ6IDAKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNhbnZhczsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYW52YXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGNhbnZhcyk7CgogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMik7CiAgfSkpOwogIHJldHVybiBfZ2V0Q2FudmFzQnlIdG1sSWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gY2FudmFzVG9QZGYoaHRtbENhbnZhcykgewogIHZhciBjYW52YXNXaWR0aCA9IGh0bWxDYW52YXMud2lkdGg7CiAgdmFyIGNhbnZhc0hlaWdodCA9IGh0bWxDYW52YXMuaGVpZ2h0OwogIHZhciBpbWdCYXNlNjQgPSBodG1sQ2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvanBlZycsIDEuMCk7IC8vIGE057q455qE5bC65a+4WzU5NS4yOCw4NDEuODld77yMaHRtbOmhtemdoueUn+aIkOeahGNhbnZhc+WcqHBkZuS4reWbvueJh+eahOWuvemrmAoKICB2YXIgaW1nV2lkdGggPSA1OTUuMjg7IC8vIOWbvueJh+mrmOW6pumcgOimgeetieavlOe8qeaUvgoKICB2YXIgaW1nSGVpZ2h0ID0gNTk1LjI4IC8gY2FudmFzV2lkdGggKiBjYW52YXNIZWlnaHQ7CiAgdmFyIHBhZ2VIZWlnaHQgPSBpbWdIZWlnaHQ7IC8vIHBkZui9rOWMluWQjumhtemdouaAu+mrmOW6pgoKICB2YXIgcG9zaXRpb24gPSAwOwogIHZhciBwZGZJbnN0YW5jZSA9IG5ldyBqc1BkZignJywgJ3B0JywgJ2E0Jyk7CiAgcGRmSW5zdGFuY2Uuc2V0Rm9udFNpemUoMTIpOwoKICBpZiAoaW1nSGVpZ2h0IDwgODQxLjg5KSB7CiAgICBwZGZJbnN0YW5jZS5hZGRJbWFnZShpbWdCYXNlNjQsICdKUEVHJywgMCwgMCwgaW1nV2lkdGgsIGltZ0hlaWdodCk7CiAgfSBlbHNlIHsKICAgIHdoaWxlIChwYWdlSGVpZ2h0ID4gMCkgewogICAgICBwZGZJbnN0YW5jZS5hZGRJbWFnZShpbWdCYXNlNjQsICdKUEVHJywgMCwgcG9zaXRpb24sIGltZ1dpZHRoLCBpbWdIZWlnaHQpOwogICAgICBwYWdlSGVpZ2h0IC09IDg0MS44OTsKICAgICAgcG9zaXRpb24gLT0gODQxLjg5OwoKICAgICAgaWYgKHBhZ2VIZWlnaHQgPiAwKSB7CiAgICAgICAgcGRmSW5zdGFuY2UuYWRkUGFnZSgpOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gcGRmSW5zdGFuY2U7Cn0KCmZ1bmN0aW9uIGRvd25QZGYocGRmSW5zdGFuY2UsIHRpdGxlKSB7CiAgLy8g5paH5Lu25ZCN6L+H6ZW/5a+86Ie05LiL6L295aSx6LSlCiAgaWYgKHRpdGxlLmxlbmd0aCA+IDUwKSB7CiAgICB0aXRsZSA9IHRpdGxlLnN1YnN0cmluZyh0aXRsZS5sZW5ndGggLSA1MCk7CiAgfQoKICBwZGZJbnN0YW5jZS5zYXZlKHRpdGxlICsgJy5wZGYnLCB7CiAgICByZXR1cm5Qcm9taXNlOiB0cnVlCiAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAvLyDmkJzni5fmtY/op4jlmajkuIvovb3mnLrliLbpl67popjmmoLml7bkuI3lhbPpl60KICAgIGlmICghKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdzZSAyLngnKSA+IC0xKSkgewogICAgICBzZXRUaW1lb3V0KHdpbmRvdy5jbG9zZSwgMzAwKTsKICAgIH0KICB9KTsKfQoKZXhwb3J0IGRlZmF1bHQgaHRtbFRvUGRmOw=="},{"version":3,"sources":["D:/workspace/bot-manager/bot-ui/src/utils/htmlToPdf.js"],"names":["html2canvas","jsPdf","htmlToPdf","title","elId","console","error","getCanvasByHtmlId","htmlCanvas","pdf","canvasToPdf","downPdf","elIdDom","document","getElementById","scale","useCORS","allowTaint","imageTimeout","then","canvas","canvasWidth","width","canvasHeight","height","imgBase64","toDataURL","imgWidth","imgHeight","pageHeight","position","pdfInstance","setFontSize","addImage","addPage","length","substring","save","returnPromise","navigator","userAgent","toLowerCase","indexOf","setTimeout","window","close"],"mappings":"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","sourcesContent":["import html2canvas from \"html2canvas\";\r\nimport jsPdf from \"jspdf\";\r\n\r\nasync function htmlToPdf(title) {\r\n  const elId = 'pdfContent' // body: 想要生成 pdf 的页面的id\r\n  if (!elId) {\r\n    // tslint:disable-next-line:no-console\r\n    console.error('导出节点不存在！')\r\n    return\r\n  }\r\n  // 将html dom节点生成canvas\r\n  const htmlCanvas = await getCanvasByHtmlId(elId)\r\n  // 将canvas对象转为pdf\r\n  const pdf = canvasToPdf(htmlCanvas)\r\n  // 通过浏览器下载pdf\r\n  downPdf(pdf, title)\r\n}\r\n\r\n/**\r\n *  @param elId 打印的节点ID\r\n */\r\nasync function getCanvasByHtmlId(elId) {\r\n  const elIdDom  = document.getElementById(elId)\r\n  const canvas  = await html2canvas(elIdDom, {\r\n    scale: 2,\r\n    useCORS: true,\r\n    allowTaint: true,\r\n    // taintTest: false,\r\n    imageTimeout: 0,\r\n  }).then((canvas) => {\r\n    return canvas\r\n  })\r\n\r\n  return canvas\r\n}\r\n\r\n/**\r\n *  @param htmlCanvas canvas对象\r\n */\r\nfunction canvasToPdf(htmlCanvas) {\r\n  const canvasWidth = htmlCanvas.width\r\n  const canvasHeight = htmlCanvas.height\r\n  const imgBase64 = htmlCanvas.toDataURL('image/jpeg', 1.0)\r\n\r\n  // a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\r\n  const imgWidth = 595.28\r\n  // 图片高度需要等比缩放\r\n  const imgHeight = 595.28 / canvasWidth * canvasHeight\r\n\r\n  let pageHeight = imgHeight // pdf转化后页面总高度\r\n  let position = 0\r\n\r\n  const pdfInstance = new jsPdf('', 'pt', 'a4')\r\n  pdfInstance.setFontSize(12)\r\n\r\n  if (imgHeight < 841.89) {\r\n    pdfInstance.addImage(imgBase64, 'JPEG', 0, 0, imgWidth, imgHeight)\r\n  } else {\r\n    while (pageHeight > 0) {\r\n      pdfInstance.addImage(imgBase64, 'JPEG', 0, position, imgWidth, imgHeight)\r\n      pageHeight -= 841.89\r\n      position -= 841.89\r\n      if (pageHeight > 0) {\r\n        pdfInstance.addPage()\r\n      }\r\n    }\r\n  }\r\n\r\n  return pdfInstance\r\n}\r\n\r\nfunction downPdf(pdfInstance, title) {\r\n  // 文件名过长导致下载失败\r\n  if (title.length > 50) {\r\n    title = title.substring(title.length - 50)\r\n  }\r\n\r\n  pdfInstance.save(title + '.pdf', { returnPromise: true }).then(() => {\r\n    // 搜狗浏览器下载机制问题暂时不关闭\r\n    if (!(navigator.userAgent.toLowerCase().indexOf('se 2.x') > -1)) {\r\n      setTimeout(window.close, 300)\r\n    }\r\n  })\r\n}\r\n\r\nexport default htmlToPdf\r\n"]}]}