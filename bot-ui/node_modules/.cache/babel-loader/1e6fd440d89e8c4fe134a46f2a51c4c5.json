{"remainingRequest":"D:\\workspace\\bot-h5\\bot-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\workspace\\bot-h5\\bot-ui\\src\\utils\\htmlToPdf.js","dependencies":[{"path":"D:\\workspace\\bot-h5\\bot-ui\\src\\utils\\htmlToPdf.js","mtime":1702475008418},{"path":"D:\\workspace\\bot-h5\\bot-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace\\bot-h5\\bot-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJEOi93b3Jrc3BhY2UvYm90LWg1L2JvdC11aS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBodG1sMmNhbnZhcyBmcm9tICJodG1sMmNhbnZhcyI7CmltcG9ydCBqc1BkZiBmcm9tICJqc3BkZiI7CgpmdW5jdGlvbiBodG1sVG9QZGYoX3gpIHsKICByZXR1cm4gX2h0bWxUb1BkZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9Ci8qKg0KICogIEBwYXJhbSBlbElkIOaJk+WNsOeahOiKgueCuUlEDQogKi8KCgpmdW5jdGlvbiBfaHRtbFRvUGRmKCkgewogIF9odG1sVG9QZGYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUodGl0bGUpIHsKICAgIHZhciBlbElkLCBodG1sQ2FudmFzLCBwZGY7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGVsSWQgPSAncGRmQ29udGVudCc7IC8vIGJvZHk6IOaDs+imgeeUn+aIkCBwZGYg55qE6aG16Z2i55qEaWQKCiAgICAgICAgICAgIGlmIChlbElkKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WvvOWHuuiKgueCueS4jeWtmOWcqO+8gScpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICByZXR1cm4gZ2V0Q2FudmFzQnlIdG1sSWQoZWxJZCk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBodG1sQ2FudmFzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgLy8g5bCGY2FudmFz5a+56LGh6L2s5Li6cGRmCiAgICAgICAgICAgIHBkZiA9IGNhbnZhc1RvUGRmKGh0bWxDYW52YXMpOyAvLyDpgJrov4fmtY/op4jlmajkuIvovb1wZGYKCiAgICAgICAgICAgIGRvd25QZGYocGRmLCB0aXRsZSk7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKICByZXR1cm4gX2h0bWxUb1BkZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBnZXRDYW52YXNCeUh0bWxJZChfeDIpIHsKICByZXR1cm4gX2dldENhbnZhc0J5SHRtbElkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KLyoqDQogKiAgQHBhcmFtIGh0bWxDYW52YXMgY2FudmFz5a+56LGhDQogKi8KCgpmdW5jdGlvbiBfZ2V0Q2FudmFzQnlIdG1sSWQoKSB7CiAgX2dldENhbnZhc0J5SHRtbElkID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihlbElkKSB7CiAgICB2YXIgZWxJZERvbSwgY2FudmFzOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZWxJZERvbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsSWQpOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBodG1sMmNhbnZhcyhlbElkRG9tLCB7CiAgICAgICAgICAgICAgc2NhbGU6IDIsCiAgICAgICAgICAgICAgdXNlQ09SUzogdHJ1ZSwKICAgICAgICAgICAgICBhbGxvd1RhaW50OiB0cnVlLAogICAgICAgICAgICAgIC8vIHRhaW50VGVzdDogZmFsc2UsCiAgICAgICAgICAgICAgaW1hZ2VUaW1lb3V0OiAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGNhbnZhcykgewogICAgICAgICAgICAgIHJldHVybiBjYW52YXM7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgY2FudmFzID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBjYW52YXMpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTIpOwogIH0pKTsKICByZXR1cm4gX2dldENhbnZhc0J5SHRtbElkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIGNhbnZhc1RvUGRmKGh0bWxDYW52YXMpIHsKICB2YXIgY2FudmFzV2lkdGggPSBodG1sQ2FudmFzLndpZHRoOwogIHZhciBjYW52YXNIZWlnaHQgPSBodG1sQ2FudmFzLmhlaWdodDsKICB2YXIgaW1nQmFzZTY0ID0gaHRtbENhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL2pwZWcnLCAxLjApOyAvLyBhNOe6uOeahOWwuuWvuFs1OTUuMjgsODQxLjg5Xe+8jGh0bWzpobXpnaLnlJ/miJDnmoRjYW52YXPlnKhwZGbkuK3lm77niYfnmoTlrr3pq5gKCiAgdmFyIGltZ1dpZHRoID0gNTk1LjI4OyAvLyDlm77niYfpq5jluqbpnIDopoHnrYnmr5TnvKnmlL4KCiAgdmFyIGltZ0hlaWdodCA9IDU5NS4yOCAvIGNhbnZhc1dpZHRoICogY2FudmFzSGVpZ2h0OwogIHZhciBwYWdlSGVpZ2h0ID0gaW1nSGVpZ2h0OyAvLyBwZGbovazljJblkI7pobXpnaLmgLvpq5jluqYKCiAgdmFyIHBvc2l0aW9uID0gMDsKICB2YXIgcGRmSW5zdGFuY2UgPSBuZXcganNQZGYoJycsICdwdCcsICdhNCcpOwogIHBkZkluc3RhbmNlLnNldEZvbnRTaXplKDEyKTsKCiAgaWYgKGltZ0hlaWdodCA8IDg0MS44OSkgewogICAgcGRmSW5zdGFuY2UuYWRkSW1hZ2UoaW1nQmFzZTY0LCAnSlBFRycsIDAsIDAsIGltZ1dpZHRoLCBpbWdIZWlnaHQpOwogIH0gZWxzZSB7CiAgICB3aGlsZSAocGFnZUhlaWdodCA+IDApIHsKICAgICAgcGRmSW5zdGFuY2UuYWRkSW1hZ2UoaW1nQmFzZTY0LCAnSlBFRycsIDAsIHBvc2l0aW9uLCBpbWdXaWR0aCwgaW1nSGVpZ2h0KTsKICAgICAgcGFnZUhlaWdodCAtPSA4NDEuODk7CiAgICAgIHBvc2l0aW9uIC09IDg0MS44OTsKCiAgICAgIGlmIChwYWdlSGVpZ2h0ID4gMCkgewogICAgICAgIHBkZkluc3RhbmNlLmFkZFBhZ2UoKTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIHBkZkluc3RhbmNlOwp9CgpmdW5jdGlvbiBkb3duUGRmKHBkZkluc3RhbmNlLCB0aXRsZSkgewogIC8vIOaWh+S7tuWQjei/h+mVv+WvvOiHtOS4i+i9veWksei0pQogIGlmICh0aXRsZS5sZW5ndGggPiA1MCkgewogICAgdGl0bGUgPSB0aXRsZS5zdWJzdHJpbmcodGl0bGUubGVuZ3RoIC0gNTApOwogIH0KCiAgcGRmSW5zdGFuY2Uuc2F2ZSh0aXRsZSArICcucGRmJywgewogICAgcmV0dXJuUHJvbWlzZTogdHJ1ZQogIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgLy8g5pCc54uX5rWP6KeI5Zmo5LiL6L295py65Yi26Zeu6aKY5pqC5pe25LiN5YWz6ZetCiAgICBpZiAoIShuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignc2UgMi54JykgPiAtMSkpIHsKICAgICAgc2V0VGltZW91dCh3aW5kb3cuY2xvc2UsIDMwMCk7CiAgICB9CiAgfSk7Cn0KCmV4cG9ydCBkZWZhdWx0IGh0bWxUb1BkZjs="},{"version":3,"sources":["D:/workspace/bot-h5/bot-ui/src/utils/htmlToPdf.js"],"names":["html2canvas","jsPdf","htmlToPdf","title","elId","console","error","getCanvasByHtmlId","htmlCanvas","pdf","canvasToPdf","downPdf","elIdDom","document","getElementById","scale","useCORS","allowTaint","imageTimeout","then","canvas","canvasWidth","width","canvasHeight","height","imgBase64","toDataURL","imgWidth","imgHeight","pageHeight","position","pdfInstance","setFontSize","addImage","addPage","length","substring","save","returnPromise","navigator","userAgent","toLowerCase","indexOf","setTimeout","window","close"],"mappings":";;;AAAA,OAAOA,WAAP,MAAwB,aAAxB;AACA,OAAOC,KAAP,MAAkB,OAAlB;;SAEeC,S;;;AAef;;;;;;uEAfA,iBAAyBC,KAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,YAAAA,IADR,GACe,YADf,EAC4B;;AAD5B,gBAEOA,IAFP;AAAA;AAAA;AAAA;;AAGI;AACAC,YAAAA,OAAO,CAACC,KAAR,CAAc,UAAd;AAJJ;;AAAA;AAAA;AAAA,mBAQ2BC,iBAAiB,CAACH,IAAD,CAR5C;;AAAA;AAQQI,YAAAA,UARR;AASE;AACMC,YAAAA,GAVR,GAUcC,WAAW,CAACF,UAAD,CAVzB,EAWE;;AACAG,YAAAA,OAAO,CAACF,GAAD,EAAMN,KAAN,CAAP;;AAZF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAkBeI,iB;;;AAef;;;;;;+EAfA,kBAAiCH,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AACQQ,YAAAA,OADR,GACmBC,QAAQ,CAACC,cAAT,CAAwBV,IAAxB,CADnB;AAAA;AAAA,mBAEwBJ,WAAW,CAACY,OAAD,EAAU;AACzCG,cAAAA,KAAK,EAAE,CADkC;AAEzCC,cAAAA,OAAO,EAAE,IAFgC;AAGzCC,cAAAA,UAAU,EAAE,IAH6B;AAIzC;AACAC,cAAAA,YAAY,EAAE;AAL2B,aAAV,CAAX,CAMnBC,IANmB,CAMd,UAACC,MAAD,EAAY;AAClB,qBAAOA,MAAP;AACD,aARqB,CAFxB;;AAAA;AAEQA,YAAAA,MAFR;AAAA,8CAYSA,MAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAkBA,SAASV,WAAT,CAAqBF,UAArB,EAAiC;AAC/B,MAAMa,WAAW,GAAGb,UAAU,CAACc,KAA/B;AACA,MAAMC,YAAY,GAAGf,UAAU,CAACgB,MAAhC;AACA,MAAMC,SAAS,GAAGjB,UAAU,CAACkB,SAAX,CAAqB,YAArB,EAAmC,GAAnC,CAAlB,CAH+B,CAK/B;;AACA,MAAMC,QAAQ,GAAG,MAAjB,CAN+B,CAO/B;;AACA,MAAMC,SAAS,GAAG,SAASP,WAAT,GAAuBE,YAAzC;AAEA,MAAIM,UAAU,GAAGD,SAAjB,CAV+B,CAUJ;;AAC3B,MAAIE,QAAQ,GAAG,CAAf;AAEA,MAAMC,WAAW,GAAG,IAAI9B,KAAJ,CAAU,EAAV,EAAc,IAAd,EAAoB,IAApB,CAApB;AACA8B,EAAAA,WAAW,CAACC,WAAZ,CAAwB,EAAxB;;AAEA,MAAIJ,SAAS,GAAG,MAAhB,EAAwB;AACtBG,IAAAA,WAAW,CAACE,QAAZ,CAAqBR,SAArB,EAAgC,MAAhC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8CE,QAA9C,EAAwDC,SAAxD;AACD,GAFD,MAEO;AACL,WAAOC,UAAU,GAAG,CAApB,EAAuB;AACrBE,MAAAA,WAAW,CAACE,QAAZ,CAAqBR,SAArB,EAAgC,MAAhC,EAAwC,CAAxC,EAA2CK,QAA3C,EAAqDH,QAArD,EAA+DC,SAA/D;AACAC,MAAAA,UAAU,IAAI,MAAd;AACAC,MAAAA,QAAQ,IAAI,MAAZ;;AACA,UAAID,UAAU,GAAG,CAAjB,EAAoB;AAClBE,QAAAA,WAAW,CAACG,OAAZ;AACD;AACF;AACF;;AAED,SAAOH,WAAP;AACD;;AAED,SAASpB,OAAT,CAAiBoB,WAAjB,EAA8B5B,KAA9B,EAAqC;AACnC;AACA,MAAIA,KAAK,CAACgC,MAAN,GAAe,EAAnB,EAAuB;AACrBhC,IAAAA,KAAK,GAAGA,KAAK,CAACiC,SAAN,CAAgBjC,KAAK,CAACgC,MAAN,GAAe,EAA/B,CAAR;AACD;;AAEDJ,EAAAA,WAAW,CAACM,IAAZ,CAAiBlC,KAAK,GAAG,MAAzB,EAAiC;AAAEmC,IAAAA,aAAa,EAAE;AAAjB,GAAjC,EAA0DnB,IAA1D,CAA+D,YAAM;AACnE;AACA,QAAI,EAAEoB,SAAS,CAACC,SAAV,CAAoBC,WAApB,GAAkCC,OAAlC,CAA0C,QAA1C,IAAsD,CAAC,CAAzD,CAAJ,EAAiE;AAC/DC,MAAAA,UAAU,CAACC,MAAM,CAACC,KAAR,EAAe,GAAf,CAAV;AACD;AACF,GALD;AAMD;;AAED,eAAe3C,SAAf","sourcesContent":["import html2canvas from \"html2canvas\";\r\nimport jsPdf from \"jspdf\";\r\n\r\nasync function htmlToPdf(title) {\r\n  const elId = 'pdfContent' // body: 想要生成 pdf 的页面的id\r\n  if (!elId) {\r\n    // tslint:disable-next-line:no-console\r\n    console.error('导出节点不存在！')\r\n    return\r\n  }\r\n  // 将html dom节点生成canvas\r\n  const htmlCanvas = await getCanvasByHtmlId(elId)\r\n  // 将canvas对象转为pdf\r\n  const pdf = canvasToPdf(htmlCanvas)\r\n  // 通过浏览器下载pdf\r\n  downPdf(pdf, title)\r\n}\r\n\r\n/**\r\n *  @param elId 打印的节点ID\r\n */\r\nasync function getCanvasByHtmlId(elId) {\r\n  const elIdDom  = document.getElementById(elId)\r\n  const canvas  = await html2canvas(elIdDom, {\r\n    scale: 2,\r\n    useCORS: true,\r\n    allowTaint: true,\r\n    // taintTest: false,\r\n    imageTimeout: 0,\r\n  }).then((canvas) => {\r\n    return canvas\r\n  })\r\n\r\n  return canvas\r\n}\r\n\r\n/**\r\n *  @param htmlCanvas canvas对象\r\n */\r\nfunction canvasToPdf(htmlCanvas) {\r\n  const canvasWidth = htmlCanvas.width\r\n  const canvasHeight = htmlCanvas.height\r\n  const imgBase64 = htmlCanvas.toDataURL('image/jpeg', 1.0)\r\n\r\n  // a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\r\n  const imgWidth = 595.28\r\n  // 图片高度需要等比缩放\r\n  const imgHeight = 595.28 / canvasWidth * canvasHeight\r\n\r\n  let pageHeight = imgHeight // pdf转化后页面总高度\r\n  let position = 0\r\n\r\n  const pdfInstance = new jsPdf('', 'pt', 'a4')\r\n  pdfInstance.setFontSize(12)\r\n\r\n  if (imgHeight < 841.89) {\r\n    pdfInstance.addImage(imgBase64, 'JPEG', 0, 0, imgWidth, imgHeight)\r\n  } else {\r\n    while (pageHeight > 0) {\r\n      pdfInstance.addImage(imgBase64, 'JPEG', 0, position, imgWidth, imgHeight)\r\n      pageHeight -= 841.89\r\n      position -= 841.89\r\n      if (pageHeight > 0) {\r\n        pdfInstance.addPage()\r\n      }\r\n    }\r\n  }\r\n\r\n  return pdfInstance\r\n}\r\n\r\nfunction downPdf(pdfInstance, title) {\r\n  // 文件名过长导致下载失败\r\n  if (title.length > 50) {\r\n    title = title.substring(title.length - 50)\r\n  }\r\n\r\n  pdfInstance.save(title + '.pdf', { returnPromise: true }).then(() => {\r\n    // 搜狗浏览器下载机制问题暂时不关闭\r\n    if (!(navigator.userAgent.toLowerCase().indexOf('se 2.x') > -1)) {\r\n      setTimeout(window.close, 300)\r\n    }\r\n  })\r\n}\r\n\r\nexport default htmlToPdf\r\n"]}]}