{"remainingRequest":"C:\\soft\\workspace\\bot-manager\\bot-ui\\node_modules\\babel-loader\\lib\\index.js!C:\\soft\\workspace\\bot-manager\\bot-ui\\src\\utils\\htmlToPdf.js","dependencies":[{"path":"C:\\soft\\workspace\\bot-manager\\bot-ui\\src\\utils\\htmlToPdf.js","mtime":1702475008418},{"path":"C:\\soft\\workspace\\bot-manager\\bot-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\soft\\workspace\\bot-manager\\bot-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9zb2Z0L3dvcmtzcGFjZS9ib3QtbWFuYWdlci9ib3QtdWkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgaHRtbDJjYW52YXMgZnJvbSAiaHRtbDJjYW52YXMiOwppbXBvcnQganNQZGYgZnJvbSAianNwZGYiOwoKZnVuY3Rpb24gaHRtbFRvUGRmKF94KSB7CiAgcmV0dXJuIF9odG1sVG9QZGYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQovKioNCiAqICBAcGFyYW0gZWxJZCDmiZPljbDnmoToioLngrlJRA0KICovCgoKZnVuY3Rpb24gX2h0bWxUb1BkZigpIHsKICBfaHRtbFRvUGRmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHRpdGxlKSB7CiAgICB2YXIgZWxJZCwgaHRtbENhbnZhcywgcGRmOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBlbElkID0gJ3BkZkNvbnRlbnQnOyAvLyBib2R5OiDmg7PopoHnlJ/miJAgcGRmIOeahOmhtemdoueahGlkCgogICAgICAgICAgICBpZiAoZWxJZCkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCflr7zlh7roioLngrnkuI3lrZjlnKjvvIEnKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjsKICAgICAgICAgICAgcmV0dXJuIGdldENhbnZhc0J5SHRtbElkKGVsSWQpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgaHRtbENhbnZhcyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIC8vIOWwhmNhbnZhc+Wvueixoei9rOS4unBkZgogICAgICAgICAgICBwZGYgPSBjYW52YXNUb1BkZihodG1sQ2FudmFzKTsgLy8g6YCa6L+H5rWP6KeI5Zmo5LiL6L29cGRmCgogICAgICAgICAgICBkb3duUGRmKHBkZiwgdGl0bGUpOwoKICAgICAgICAgIGNhc2UgOToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlKTsKICB9KSk7CiAgcmV0dXJuIF9odG1sVG9QZGYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gZ2V0Q2FudmFzQnlIdG1sSWQoX3gyKSB7CiAgcmV0dXJuIF9nZXRDYW52YXNCeUh0bWxJZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9Ci8qKg0KICogIEBwYXJhbSBodG1sQ2FudmFzIGNhbnZhc+WvueixoQ0KICovCgoKZnVuY3Rpb24gX2dldENhbnZhc0J5SHRtbElkKCkgewogIF9nZXRDYW52YXNCeUh0bWxJZCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoZWxJZCkgewogICAgdmFyIGVsSWREb20sIGNhbnZhczsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGVsSWREb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbElkKTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICByZXR1cm4gaHRtbDJjYW52YXMoZWxJZERvbSwgewogICAgICAgICAgICAgIHNjYWxlOiAyLAogICAgICAgICAgICAgIHVzZUNPUlM6IHRydWUsCiAgICAgICAgICAgICAgYWxsb3dUYWludDogdHJ1ZSwKICAgICAgICAgICAgICAvLyB0YWludFRlc3Q6IGZhbHNlLAogICAgICAgICAgICAgIGltYWdlVGltZW91dDogMAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChjYW52YXMpIHsKICAgICAgICAgICAgICByZXR1cm4gY2FudmFzOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGNhbnZhcyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgY2FudmFzKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUyKTsKICB9KSk7CiAgcmV0dXJuIF9nZXRDYW52YXNCeUh0bWxJZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBjYW52YXNUb1BkZihodG1sQ2FudmFzKSB7CiAgdmFyIGNhbnZhc1dpZHRoID0gaHRtbENhbnZhcy53aWR0aDsKICB2YXIgY2FudmFzSGVpZ2h0ID0gaHRtbENhbnZhcy5oZWlnaHQ7CiAgdmFyIGltZ0Jhc2U2NCA9IGh0bWxDYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMS4wKTsgLy8gYTTnurjnmoTlsLrlr7hbNTk1LjI4LDg0MS44OV3vvIxodG1s6aG16Z2i55Sf5oiQ55qEY2FudmFz5ZyocGRm5Lit5Zu+54mH55qE5a696auYCgogIHZhciBpbWdXaWR0aCA9IDU5NS4yODsgLy8g5Zu+54mH6auY5bqm6ZyA6KaB562J5q+U57yp5pS+CgogIHZhciBpbWdIZWlnaHQgPSA1OTUuMjggLyBjYW52YXNXaWR0aCAqIGNhbnZhc0hlaWdodDsKICB2YXIgcGFnZUhlaWdodCA9IGltZ0hlaWdodDsgLy8gcGRm6L2s5YyW5ZCO6aG16Z2i5oC76auY5bqmCgogIHZhciBwb3NpdGlvbiA9IDA7CiAgdmFyIHBkZkluc3RhbmNlID0gbmV3IGpzUGRmKCcnLCAncHQnLCAnYTQnKTsKICBwZGZJbnN0YW5jZS5zZXRGb250U2l6ZSgxMik7CgogIGlmIChpbWdIZWlnaHQgPCA4NDEuODkpIHsKICAgIHBkZkluc3RhbmNlLmFkZEltYWdlKGltZ0Jhc2U2NCwgJ0pQRUcnLCAwLCAwLCBpbWdXaWR0aCwgaW1nSGVpZ2h0KTsKICB9IGVsc2UgewogICAgd2hpbGUgKHBhZ2VIZWlnaHQgPiAwKSB7CiAgICAgIHBkZkluc3RhbmNlLmFkZEltYWdlKGltZ0Jhc2U2NCwgJ0pQRUcnLCAwLCBwb3NpdGlvbiwgaW1nV2lkdGgsIGltZ0hlaWdodCk7CiAgICAgIHBhZ2VIZWlnaHQgLT0gODQxLjg5OwogICAgICBwb3NpdGlvbiAtPSA4NDEuODk7CgogICAgICBpZiAocGFnZUhlaWdodCA+IDApIHsKICAgICAgICBwZGZJbnN0YW5jZS5hZGRQYWdlKCk7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBwZGZJbnN0YW5jZTsKfQoKZnVuY3Rpb24gZG93blBkZihwZGZJbnN0YW5jZSwgdGl0bGUpIHsKICAvLyDmlofku7blkI3ov4fplb/lr7zoh7TkuIvovb3lpLHotKUKICBpZiAodGl0bGUubGVuZ3RoID4gNTApIHsKICAgIHRpdGxlID0gdGl0bGUuc3Vic3RyaW5nKHRpdGxlLmxlbmd0aCAtIDUwKTsKICB9CgogIHBkZkluc3RhbmNlLnNhdmUodGl0bGUgKyAnLnBkZicsIHsKICAgIHJldHVyblByb21pc2U6IHRydWUKICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgIC8vIOaQnOeLl+a1j+iniOWZqOS4i+i9veacuuWItumXrumimOaaguaXtuS4jeWFs+mXrQogICAgaWYgKCEobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ3NlIDIueCcpID4gLTEpKSB7CiAgICAgIHNldFRpbWVvdXQod2luZG93LmNsb3NlLCAzMDApOwogICAgfQogIH0pOwp9CgpleHBvcnQgZGVmYXVsdCBodG1sVG9QZGY7"},{"version":3,"sources":["C:/soft/workspace/bot-manager/bot-ui/src/utils/htmlToPdf.js"],"names":["html2canvas","jsPdf","htmlToPdf","title","elId","console","error","getCanvasByHtmlId","htmlCanvas","pdf","canvasToPdf","downPdf","elIdDom","document","getElementById","scale","useCORS","allowTaint","imageTimeout","then","canvas","canvasWidth","width","canvasHeight","height","imgBase64","toDataURL","imgWidth","imgHeight","pageHeight","position","pdfInstance","setFontSize","addImage","addPage","length","substring","save","returnPromise","navigator","userAgent","toLowerCase","indexOf","setTimeout","window","close"],"mappings":";;;AAAA,OAAOA,WAAP,MAAwB,aAAxB;AACA,OAAOC,KAAP,MAAkB,OAAlB;;SAEeC,S;;;AAef;;;;;;uEAfA,iBAAyBC,KAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,YAAAA,IADR,GACe,YADf,EAC4B;;AAD5B,gBAEOA,IAFP;AAAA;AAAA;AAAA;;AAGI;AACAC,YAAAA,OAAO,CAACC,KAAR,CAAc,UAAd;AAJJ;;AAAA;AAAA;AAAA,mBAQ2BC,iBAAiB,CAACH,IAAD,CAR5C;;AAAA;AAQQI,YAAAA,UARR;AASE;AACMC,YAAAA,GAVR,GAUcC,WAAW,CAACF,UAAD,CAVzB,EAWE;;AACAG,YAAAA,OAAO,CAACF,GAAD,EAAMN,KAAN,CAAP;;AAZF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAkBeI,iB;;;AAef;;;;;;+EAfA,kBAAiCH,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AACQQ,YAAAA,OADR,GACmBC,QAAQ,CAACC,cAAT,CAAwBV,IAAxB,CADnB;AAAA;AAAA,mBAEwBJ,WAAW,CAACY,OAAD,EAAU;AACzCG,cAAAA,KAAK,EAAE,CADkC;AAEzCC,cAAAA,OAAO,EAAE,IAFgC;AAGzCC,cAAAA,UAAU,EAAE,IAH6B;AAIzC;AACAC,cAAAA,YAAY,EAAE;AAL2B,aAAV,CAAX,CAMnBC,IANmB,CAMd,UAACC,MAAD,EAAY;AAClB,qBAAOA,MAAP;AACD,aARqB,CAFxB;;AAAA;AAEQA,YAAAA,MAFR;AAAA,8CAYSA,MAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAkBA,SAASV,WAAT,CAAqBF,UAArB,EAAiC;AAC/B,MAAMa,WAAW,GAAGb,UAAU,CAACc,KAA/B;AACA,MAAMC,YAAY,GAAGf,UAAU,CAACgB,MAAhC;AACA,MAAMC,SAAS,GAAGjB,UAAU,CAACkB,SAAX,CAAqB,YAArB,EAAmC,GAAnC,CAAlB,CAH+B,CAK/B;;AACA,MAAMC,QAAQ,GAAG,MAAjB,CAN+B,CAO/B;;AACA,MAAMC,SAAS,GAAG,SAASP,WAAT,GAAuBE,YAAzC;AAEA,MAAIM,UAAU,GAAGD,SAAjB,CAV+B,CAUJ;;AAC3B,MAAIE,QAAQ,GAAG,CAAf;AAEA,MAAMC,WAAW,GAAG,IAAI9B,KAAJ,CAAU,EAAV,EAAc,IAAd,EAAoB,IAApB,CAApB;AACA8B,EAAAA,WAAW,CAACC,WAAZ,CAAwB,EAAxB;;AAEA,MAAIJ,SAAS,GAAG,MAAhB,EAAwB;AACtBG,IAAAA,WAAW,CAACE,QAAZ,CAAqBR,SAArB,EAAgC,MAAhC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8CE,QAA9C,EAAwDC,SAAxD;AACD,GAFD,MAEO;AACL,WAAOC,UAAU,GAAG,CAApB,EAAuB;AACrBE,MAAAA,WAAW,CAACE,QAAZ,CAAqBR,SAArB,EAAgC,MAAhC,EAAwC,CAAxC,EAA2CK,QAA3C,EAAqDH,QAArD,EAA+DC,SAA/D;AACAC,MAAAA,UAAU,IAAI,MAAd;AACAC,MAAAA,QAAQ,IAAI,MAAZ;;AACA,UAAID,UAAU,GAAG,CAAjB,EAAoB;AAClBE,QAAAA,WAAW,CAACG,OAAZ;AACD;AACF;AACF;;AAED,SAAOH,WAAP;AACD;;AAED,SAASpB,OAAT,CAAiBoB,WAAjB,EAA8B5B,KAA9B,EAAqC;AACnC;AACA,MAAIA,KAAK,CAACgC,MAAN,GAAe,EAAnB,EAAuB;AACrBhC,IAAAA,KAAK,GAAGA,KAAK,CAACiC,SAAN,CAAgBjC,KAAK,CAACgC,MAAN,GAAe,EAA/B,CAAR;AACD;;AAEDJ,EAAAA,WAAW,CAACM,IAAZ,CAAiBlC,KAAK,GAAG,MAAzB,EAAiC;AAAEmC,IAAAA,aAAa,EAAE;AAAjB,GAAjC,EAA0DnB,IAA1D,CAA+D,YAAM;AACnE;AACA,QAAI,EAAEoB,SAAS,CAACC,SAAV,CAAoBC,WAApB,GAAkCC,OAAlC,CAA0C,QAA1C,IAAsD,CAAC,CAAzD,CAAJ,EAAiE;AAC/DC,MAAAA,UAAU,CAACC,MAAM,CAACC,KAAR,EAAe,GAAf,CAAV;AACD;AACF,GALD;AAMD;;AAED,eAAe3C,SAAf","sourcesContent":["import html2canvas from \"html2canvas\";\r\nimport jsPdf from \"jspdf\";\r\n\r\nasync function htmlToPdf(title) {\r\n  const elId = 'pdfContent' // body: 想要生成 pdf 的页面的id\r\n  if (!elId) {\r\n    // tslint:disable-next-line:no-console\r\n    console.error('导出节点不存在！')\r\n    return\r\n  }\r\n  // 将html dom节点生成canvas\r\n  const htmlCanvas = await getCanvasByHtmlId(elId)\r\n  // 将canvas对象转为pdf\r\n  const pdf = canvasToPdf(htmlCanvas)\r\n  // 通过浏览器下载pdf\r\n  downPdf(pdf, title)\r\n}\r\n\r\n/**\r\n *  @param elId 打印的节点ID\r\n */\r\nasync function getCanvasByHtmlId(elId) {\r\n  const elIdDom  = document.getElementById(elId)\r\n  const canvas  = await html2canvas(elIdDom, {\r\n    scale: 2,\r\n    useCORS: true,\r\n    allowTaint: true,\r\n    // taintTest: false,\r\n    imageTimeout: 0,\r\n  }).then((canvas) => {\r\n    return canvas\r\n  })\r\n\r\n  return canvas\r\n}\r\n\r\n/**\r\n *  @param htmlCanvas canvas对象\r\n */\r\nfunction canvasToPdf(htmlCanvas) {\r\n  const canvasWidth = htmlCanvas.width\r\n  const canvasHeight = htmlCanvas.height\r\n  const imgBase64 = htmlCanvas.toDataURL('image/jpeg', 1.0)\r\n\r\n  // a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\r\n  const imgWidth = 595.28\r\n  // 图片高度需要等比缩放\r\n  const imgHeight = 595.28 / canvasWidth * canvasHeight\r\n\r\n  let pageHeight = imgHeight // pdf转化后页面总高度\r\n  let position = 0\r\n\r\n  const pdfInstance = new jsPdf('', 'pt', 'a4')\r\n  pdfInstance.setFontSize(12)\r\n\r\n  if (imgHeight < 841.89) {\r\n    pdfInstance.addImage(imgBase64, 'JPEG', 0, 0, imgWidth, imgHeight)\r\n  } else {\r\n    while (pageHeight > 0) {\r\n      pdfInstance.addImage(imgBase64, 'JPEG', 0, position, imgWidth, imgHeight)\r\n      pageHeight -= 841.89\r\n      position -= 841.89\r\n      if (pageHeight > 0) {\r\n        pdfInstance.addPage()\r\n      }\r\n    }\r\n  }\r\n\r\n  return pdfInstance\r\n}\r\n\r\nfunction downPdf(pdfInstance, title) {\r\n  // 文件名过长导致下载失败\r\n  if (title.length > 50) {\r\n    title = title.substring(title.length - 50)\r\n  }\r\n\r\n  pdfInstance.save(title + '.pdf', { returnPromise: true }).then(() => {\r\n    // 搜狗浏览器下载机制问题暂时不关闭\r\n    if (!(navigator.userAgent.toLowerCase().indexOf('se 2.x') > -1)) {\r\n      setTimeout(window.close, 300)\r\n    }\r\n  })\r\n}\r\n\r\nexport default htmlToPdf\r\n"]}]}